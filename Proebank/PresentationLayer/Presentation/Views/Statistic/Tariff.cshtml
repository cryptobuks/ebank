@using Domain.Enums
@using Domain.Models.Loans
@model IEnumerable<Domain.Models.Loans.Loan>

@{
    ViewBag.Title = "Tariff Statistics";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<h2>Tariff Statistics</h2>
<hr/>
@{
    var listActiveTariff = Model.Where(x => x.IsClosed == false).Select(x => x.Application.Tariff.Name).GroupBy(y => y).ToList();
    var xPreActiveTariff = listActiveTariff.Select(x => x.Key.ToString()).ToList();
    string xActiveTariff = xPreActiveTariff.Any() ? xPreActiveTariff.Aggregate((x, y) => x + ", " + y) : "No active loans";
    var yPreActiveTariff = listActiveTariff.Select(x => x.Count().ToString()).ToList();
    string yActiveTariff = yPreActiveTariff.Any() ? yPreActiveTariff.Aggregate((x, y) => x + ", " + y) : "100";
}
<h4 align="center">Active tariffs information: </h4>
<div id="activeTariff" style="width: 100%; height: 400px;"></div>
<script type="text/javascript">
    AmCharts.ready(function () {
        var chart1;
        var chartData = new Array();
        chart1 = new AmCharts.AmPieChart();
        chart1.titleField = "title";
        chart1.valueField = "value";
        chart1.balloonText = "[[title]]<br><span style='font-size:14px'><b>[[value]]</b> ([[percents]]%)</span>";
        chart1.depth3D = 15;
        chart1.angle = 30;

        var x = '@xActiveTariff'.split(', ');
        var y = '@yActiveTariff'.split(', ');
        chartData = new Array();
        for (var i = 0; i < x.length; i++) {
            chartData.push({
                title: x[i],
                value: y[i]
            });
        }
        chart1.dataProvider = chartData;
        chart1.write("activeTariff");

        $('g').children('text').children('tspan').contents().filter(function () {
            return $(this).text() == 'chart by amcharts.com';
        }).remove();
    });
</script>